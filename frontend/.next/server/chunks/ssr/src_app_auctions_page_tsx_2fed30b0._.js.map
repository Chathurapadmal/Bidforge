{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///D:/Bidforge/frontend/src/app/auctions/page.tsx"],"sourcesContent":["// src/app/auctions/page.tsx\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport Link from \"next/link\";\r\nimport { API_BASE } from \"../../lib/Config\"; // ensure lowercase file name: config.ts\r\n\r\ntype Auction = {\r\n  id: number;\r\n  title: string;\r\n  currentBid: number;\r\n  startTime?: string | null;\r\n  endTime?: string | null;\r\n  image?: string | null; // \"/uploads/auctions/1/main.jpg\" or absolute URL\r\n  badge?: string | null;\r\n};\r\n\r\ntype ListResp = {\r\n  page: number;\r\n  pageSize: number;\r\n  total: number;\r\n  items: Auction[];\r\n};\r\n\r\nconst PLACEHOLDER = \"/placeholder.png\";\r\n\r\n// If you set NEXT_PUBLIC_API_BASE_URL, we’ll use it to build absolute image URLs.\r\n// Otherwise we try same-origin (make sure you proxy /images or /uploads in next.config).\r\nconst BACKEND_ORIGIN = (process.env.NEXT_PUBLIC_API_BASE_URL || \"\").replace(/\\/+$/, \"\");\r\n\r\n// Turn API image path into a usable <img src>\r\nfunction toImageSrc(img?: string | null): string {\r\n  if (!img) return PLACEHOLDER;\r\n  let s = img.trim();\r\n  if (!s) return PLACEHOLDER;\r\n  try { s = decodeURIComponent(s); } catch {}\r\n  if (/^https?:\\/\\//i.test(s)) return s;                 // already absolute\r\n  if (BACKEND_ORIGIN) {\r\n    if (s.startsWith(\"/\")) return `${BACKEND_ORIGIN}${s}`;\r\n    return `${BACKEND_ORIGIN}/${s.replace(/^\\/+/, \"\")}`;\r\n  }\r\n  // Same-origin fallback (requires rewrites for static files)\r\n  return s.startsWith(\"/\") ? s : `/${s}`;\r\n}\r\n\r\nexport default function AuctionsPage() {\r\n  const [data, setData] = useState<ListResp | null>(null);\r\n  const [page, setPage] = useState(1);\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState<string | null>(null);\r\n\r\n  async function load(p = 1) {\r\n    setLoading(true);\r\n    setErr(null);\r\n    try {\r\n      const res = await fetch(\r\n        `${API_BASE}/api/auctions?sort=endingSoon&limit=12&page=${p}`,\r\n        { cache: \"no-store\" }\r\n      );\r\n      if (!res.ok) {\r\n        const text = await res.text().catch(() => \"\");\r\n        throw new Error(`Auctions fetch failed (${res.status})${text ? ` – ${text}` : \"\"}`);\r\n      }\r\n      const j = (await res.json()) as ListResp;\r\n      setData(j);\r\n      setPage(j.page ?? p);\r\n    } catch (e: any) {\r\n      setErr(e?.message ?? \"Failed to load auctions\");\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    void load(1);\r\n  }, []);\r\n\r\n  const totalPages = data ? Math.max(1, Math.ceil(data.total / data.pageSize)) : 1;\r\n\r\n  return (\r\n    <main className=\"max-w-6xl mx-auto p-6\">\r\n      <h1 className=\"text-2xl font-bold\">Auctions</h1>\r\n\r\n      {err && <p className=\"mt-4 text-red-600 break-words\">{err}</p>}\r\n      {loading && <p className=\"mt-4 text-gray-600\">Loading…</p>}\r\n\r\n      {!loading && data && (\r\n        <>\r\n          <div className=\"mt-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-5\">\r\n            {data.items.map((a) => {\r\n              const imgSrc = toImageSrc(a.image); // no hooks in loops\r\n              return (\r\n                <article key={a.id} className=\"rounded-xl overflow-hidden border bg-white\">\r\n                  <div className=\"aspect-[4/3] overflow-hidden bg-gray-100\">\r\n                    <img\r\n                      src={imgSrc}\r\n                      alt={a.title}\r\n                      className=\"w-full h-full object-cover\"\r\n                      onError={(e) => {\r\n                        (e.currentTarget as HTMLImageElement).src = PLACEHOLDER;\r\n                      }}\r\n                      loading=\"lazy\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-4\">\r\n                    <h3 className=\"font-semibold line-clamp-2\">{a.title}</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-600\">Current bid</p>\r\n                    <p className=\"font-semibold\">LKR {a.currentBid.toLocaleString()}</p>\r\n                    <div className=\"mt-3\">\r\n                      <Link className=\"text-indigo-600 hover:underline\" href={`/productDetail/${a.id}`}>\r\n                        View\r\n                      </Link>\r\n                    </div>\r\n                  </div>\r\n                </article>\r\n              );\r\n            })}\r\n          </div>\r\n\r\n          <div className=\"flex items-center gap-3 mt-6\">\r\n            <button\r\n              disabled={page <= 1}\r\n              onClick={() => load(page - 1)}\r\n              className=\"px-3 py-1 border rounded disabled:opacity-50\"\r\n            >\r\n              Prev\r\n            </button>\r\n            <span className=\"text-sm text-gray-600\">\r\n              Page {page} of {totalPages}\r\n            </span>\r\n            <button\r\n              disabled={page >= totalPages}\r\n              onClick={() => load(page + 1)}\r\n              className=\"px-3 py-1 border rounded disabled:opacity-50\"\r\n            >\r\n              Next\r\n            </button>\r\n          </div>\r\n        </>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}