{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder/Bidforge/frontend/src/app/admin/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { apiFetch } from \"../../lib/api\";\r\nimport { toImageSrc } from \"../../lib/Config\";\r\n\r\ntype AdminUser = {\r\n  id: string;\r\n  email: string | null;\r\n  name: string | null;\r\n  emailConfirmed: boolean;\r\n  roles: string[];\r\n  kycStatus: string;\r\n  nic?: string | null;\r\n  selfie?: string | null;\r\n  avatar?: string | null;\r\n};\r\n\r\ntype PendingKycUser = {\r\n  id: string;\r\n  email: string | null;\r\n  name: string | null;\r\n  nic?: string | null;\r\n  selfie?: string | null;\r\n};\r\n\r\nexport default function AdminPage() {\r\n  const router = useRouter();\r\n  const [loading, setLoading] = useState(true);\r\n  const [authErr, setAuthErr] = useState<string | null>(null);\r\n\r\n  const [tab, setTab] = useState<\"KYC Review\" | \"Users\">(\"KYC Review\");\r\n  const [pending, setPending] = useState<PendingKycUser[] | null>(null);\r\n  const [users, setUsers] = useState<AdminUser[] | null>(null);\r\n\r\n  // users tab filters\r\n  const [q, setQ] = useState(\"\");\r\n  const [kyc, setKyc] = useState<\r\n    \"\" | \"pending\" | \"approved\" | \"rejected\" | \"none\"\r\n  >(\"\");\r\n\r\n  const loadPending = async () => {\r\n    const list = await apiFetch<PendingKycUser[]>(\"/api/admin/kyc/pending\");\r\n    setPending(list);\r\n  };\r\n\r\n  const loadUsers = async () => {\r\n    const qs = new URLSearchParams();\r\n    if (q.trim()) qs.set(\"query\", q.trim());\r\n    if (kyc) qs.set(\"kyc\", kyc);\r\n    const list = await apiFetch<AdminUser[]>(\r\n      `/api/admin/users?${qs.toString()}`\r\n    );\r\n    setUsers(list);\r\n  };\r\n\r\n  const init = async () => {\r\n    try {\r\n      await loadPending();\r\n      await loadUsers();\r\n      setLoading(false);\r\n    } catch (e: any) {\r\n      // If 401/403, you aren't admin or not logged in\r\n      setAuthErr(e?.message ?? \"Unauthorized\");\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    void init();\r\n  }, []);\r\n\r\n  const onApprove = async (userId: string) => {\r\n    try {\r\n      await apiFetch(`/api/admin/kyc/approve/${userId}`, { method: \"POST\" });\r\n      await loadPending();\r\n      await loadUsers();\r\n    } catch {}\r\n  };\r\n\r\n  const onReject = async (userId: string) => {\r\n    try {\r\n      await apiFetch(`/api/admin/kyc/reject/${userId}`, { method: \"POST\" });\r\n      await loadPending();\r\n      await loadUsers();\r\n    } catch {}\r\n  };\r\n\r\n  const onDeleteUser = async (userId: string) => {\r\n    if (!confirm(\"Delete this user? This cannot be undone.\")) return;\r\n    try {\r\n      await apiFetch(`/api/admin/users/${userId}`, { method: \"DELETE\" });\r\n      await loadPending();\r\n      await loadUsers();\r\n    } catch (e: any) {\r\n      alert(e?.message ?? \"Delete failed\");\r\n    }\r\n  };\r\n\r\n  const filteredPending = pending ?? [];\r\n\r\n  if (loading) return <main className=\"max-w-6xl mx-auto p-6\">Loadingâ€¦</main>;\r\n  if (authErr)\r\n    return (\r\n      <main className=\"max-w-xl mx-auto p-6\">\r\n        <h1 className=\"text-2xl font-bold\">Admin</h1>\r\n        <p className=\"mt-4 text-red-600\">\r\n          Not authorized. Log in as an admin user.\r\n        </p>\r\n      </main>\r\n    );\r\n\r\n  return (\r\n    <main className=\"max-w-7xl mx-auto p-6\">\r\n      <h1 className=\"text-2xl font-bold\">Admin Dashboard</h1>\r\n\r\n      <div className=\"mt-6 flex gap-2 border-b\">\r\n        {([\"KYC Review\", \"Users\"] as const).map((t) => (\r\n          <button\r\n            key={t}\r\n            className={`px-3 py-2 -mb-px border-b-2 ${tab === t ? \"border-indigo-600 text-indigo-700\" : \"border-transparent text-gray-600\"}`}\r\n            onClick={() => setTab(t)}\r\n          >\r\n            {t}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {/* KYC REVIEW */}\r\n      {tab === \"KYC Review\" && (\r\n        <section className=\"mt-6\">\r\n          {filteredPending.length === 0 ? (\r\n            <p className=\"text-gray-600\">No pending verifications.</p>\r\n          ) : (\r\n            <div className=\"grid md:grid-cols-2 xl:grid-cols-3 gap-5\">\r\n              {filteredPending.map((u) => (\r\n                <article\r\n                  key={u.id}\r\n                  className=\"border rounded bg-white overflow-hidden\"\r\n                >\r\n                  <div className=\"p-3 border-b\">\r\n                    <div className=\"font-semibold\">{u.name || u.email}</div>\r\n                    <div className=\"text-xs text-gray-500\">{u.email}</div>\r\n                  </div>\r\n                  <div className=\"grid grid-cols-2 gap-2 p-3\">\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-600 mb-1\">NIC</div>\r\n                      <div className=\"aspect-[4/3] bg-gray-100 overflow-hidden rounded\">\r\n                        <img\r\n                          src={toImageSrc(u.nic || undefined)}\r\n                          alt=\"nic\"\r\n                          className=\"w-full h-full object-cover\"\r\n                          onError={(e) => {\r\n                            (e.currentTarget as HTMLImageElement).src =\r\n                              \"/placeholder.png\";\r\n                          }}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                    <div>\r\n                      <div className=\"text-xs text-gray-600 mb-1\">Selfie</div>\r\n                      <div className=\"aspect-[4/3] bg-gray-100 overflow-hidden rounded\">\r\n                        <img\r\n                          src={toImageSrc(u.selfie || undefined)}\r\n                          alt=\"selfie\"\r\n                          className=\"w-full h-full object-cover\"\r\n                          onError={(e) => {\r\n                            (e.currentTarget as HTMLImageElement).src =\r\n                              \"/placeholder.png\";\r\n                          }}\r\n                        />\r\n                      </div>\r\n                    </div>\r\n                  </div>\r\n                  <div className=\"flex gap-2 p-3 border-t\">\r\n                    <button\r\n                      onClick={() => onApprove(u.id)}\r\n                      className=\"px-3 py-1.5 rounded bg-emerald-600 text-white\"\r\n                    >\r\n                      Approve\r\n                    </button>\r\n                    <button\r\n                      onClick={() => onReject(u.id)}\r\n                      className=\"px-3 py-1.5 rounded bg-amber-600 text-white\"\r\n                    >\r\n                      Reject\r\n                    </button>\r\n                  </div>\r\n                </article>\r\n              ))}\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n\r\n      {/* USERS */}\r\n      {tab === \"Users\" && (\r\n        <section className=\"mt-6\">\r\n          <div className=\"flex flex-wrap gap-2 items-end\">\r\n            <div>\r\n              <label className=\"text-xs text-gray-600\">Search</label>\r\n              <input\r\n                value={q}\r\n                onChange={(e) => setQ(e.target.value)}\r\n                placeholder=\"name, email, id\"\r\n                className=\"block border p-2 rounded\"\r\n              />\r\n            </div>\r\n            <div>\r\n              <label className=\"text-xs text-gray-600\">KYC</label>\r\n              <select\r\n                value={kyc}\r\n                onChange={(e) => setKyc(e.target.value as any)}\r\n                className=\"block border p-2 rounded\"\r\n              >\r\n                <option value=\"\">(all)</option>\r\n                <option value=\"pending\">pending</option>\r\n                <option value=\"approved\">approved</option>\r\n                <option value=\"rejected\">rejected</option>\r\n                <option value=\"none\">none</option>\r\n              </select>\r\n            </div>\r\n            <button onClick={loadUsers} className=\"px-3 py-2 border rounded\">\r\n              Apply\r\n            </button>\r\n          </div>\r\n\r\n          {!users || users.length === 0 ? (\r\n            <p className=\"mt-4 text-gray-600\">No users.</p>\r\n          ) : (\r\n            <div className=\"mt-4 overflow-x-auto bg-white border rounded\">\r\n              <table className=\"min-w-full text-sm\">\r\n                <thead className=\"bg-gray-50\">\r\n                  <tr>\r\n                    <th className=\"text-left p-2\">User</th>\r\n                    <th className=\"text-left p-2\">Email</th>\r\n                    <th className=\"text-left p-2\">Email Verified</th>\r\n                    <th className=\"text-left p-2\">Roles</th>\r\n                    <th className=\"text-left p-2\">KYC</th>\r\n                    <th className=\"p-2\"></th>\r\n                  </tr>\r\n                </thead>\r\n                <tbody>\r\n                  {users.map((u) => (\r\n                    <tr key={u.id} className=\"border-t\">\r\n                      <td className=\"p-2\">\r\n                        <div className=\"flex items-center gap-2\">\r\n                          <img\r\n                            src={toImageSrc(u.avatar || undefined)}\r\n                            alt=\"\"\r\n                            className=\"w-8 h-8 object-cover rounded-full border\"\r\n                            onError={(e) => {\r\n                              (e.currentTarget as HTMLImageElement).src =\r\n                                \"/placeholder.png\";\r\n                            }}\r\n                          />\r\n                          <div>\r\n                            <div className=\"font-medium\">{u.name}</div>\r\n                            <div className=\"text-xs text-gray-500\">{u.id}</div>\r\n                          </div>\r\n                        </div>\r\n                      </td>\r\n                      <td className=\"p-2\">{u.email}</td>\r\n                      <td className=\"p-2\">{u.emailConfirmed ? \"Yes\" : \"No\"}</td>\r\n                      <td className=\"p-2\">\r\n                        {u.roles?.length ? u.roles.join(\", \") : \"â€”\"}\r\n                      </td>\r\n                      <td className=\"p-2\">\r\n                        <span\r\n                          className={`px-2 py-0.5 rounded text-xs ${kycBadge(u.kycStatus)}`}\r\n                        >\r\n                          {u.kycStatus}\r\n                        </span>\r\n                      </td>\r\n                      <td className=\"p-2 text-right\">\r\n                        <button\r\n                          onClick={() => onDeleteUser(u.id)}\r\n                          className=\"px-3 py-1.5 rounded border\"\r\n                        >\r\n                          Delete\r\n                        </button>\r\n                      </td>\r\n                    </tr>\r\n                  ))}\r\n                </tbody>\r\n              </table>\r\n            </div>\r\n          )}\r\n        </section>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n\r\nfunction kycBadge(status: string) {\r\n  switch ((status || \"none\").toLowerCase()) {\r\n    case \"approved\":\r\n      return \"bg-emerald-50 text-emerald-700\";\r\n    case \"pending\":\r\n      return \"bg-amber-50 text-amber-700\";\r\n    case \"rejected\":\r\n      return \"bg-rose-50 text-rose-700\";\r\n    default:\r\n      return \"bg-gray-100 text-gray-700\";\r\n  }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}