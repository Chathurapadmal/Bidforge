{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///E:/New%20folder/Bidforge/frontend/src/app/profile/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useSession } from \"../../lib/session\";\r\nimport { apiFetch, apiFetchForm } from \"../../lib/api\";\r\nimport { toImageSrc } from \"../../lib/Config\";\r\n\r\ntype KycState = {\r\n  status: string;\r\n  nic?: string | null;\r\n  selfie?: string | null;\r\n  reviewedAt?: string | null;\r\n};\r\n\r\nexport default function ProfilePage() {\r\n  const { user, loading, refresh } = useSession();\r\n  const router = useRouter();\r\n\r\n  const tabs = [\"Profile\", \"Verification\"] as const;\r\n  type Tab = (typeof tabs)[number];\r\n  const [tab, setTab] = useState<Tab>(\"Profile\");\r\n\r\n  const [name, setName] = useState(user?.name || \"\");\r\n  const [avatarFile, setAvatarFile] = useState<File | null>(null);\r\n  const [kyc, setKyc] = useState<KycState | null>(null);\r\n  const [nicFile, setNicFile] = useState<File | null>(null);\r\n  const [selfieFile, setSelfieFile] = useState<File | null>(null);\r\n\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [info, setInfo] = useState<string | null>(null);\r\n  const [busy, setBusy] = useState(false);\r\n\r\n  useEffect(() => {\r\n    void refresh();\r\n  }, [refresh]);\r\n  useEffect(() => {\r\n    if (!loading && !user) router.replace(\"/auth/login?next=/profile\");\r\n  }, [loading, user, router]);\r\n\r\n  useEffect(() => {\r\n    if (user) void loadKyc();\r\n  }, [user]);\r\n\r\n  const loadKyc = async () => {\r\n    try {\r\n      const s = await apiFetch<KycState>(\"/api/kyc\");\r\n      setKyc(s);\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n  };\r\n\r\n  const onSaveProfile = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setErr(null);\r\n    setInfo(null);\r\n    setBusy(true);\r\n    try {\r\n      await apiFetch(\"/api/profile\", {\r\n        method: \"PUT\",\r\n        body: JSON.stringify({ name }),\r\n      });\r\n      setInfo(\"Profile updated.\");\r\n    } catch (e: any) {\r\n      setErr(e?.message ?? \"Update failed\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  const onUploadAvatar = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    if (!avatarFile) return;\r\n    setErr(null);\r\n    setInfo(null);\r\n    setBusy(true);\r\n    try {\r\n      const fd = new FormData();\r\n      fd.append(\"file\", avatarFile);\r\n      await apiFetchForm(\"/api/profile/avatar\", fd, { method: \"POST\" });\r\n      setAvatarFile(null);\r\n      setInfo(\"Avatar updated.\");\r\n    } catch (e: any) {\r\n      setErr(e?.message ?? \"Upload failed\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  const submitKyc = async (type: \"nic\" | \"selfie\") => {\r\n    const file = type === \"nic\" ? nicFile : selfieFile;\r\n    if (!file) return;\r\n    setErr(null);\r\n    setInfo(null);\r\n    setBusy(true);\r\n    try {\r\n      const fd = new FormData();\r\n      fd.append(\"file\", file);\r\n      await apiFetchForm(`/api/kyc/${type}`, fd, { method: \"POST\" });\r\n      if (type === \"nic\") setNicFile(null);\r\n      else setSelfieFile(null);\r\n      await loadKyc();\r\n      setInfo(`${type.toUpperCase()} uploaded.`);\r\n    } catch (e: any) {\r\n      setErr(e?.message ?? \"Upload failed\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  if (loading || !user)\r\n    return <main className=\"max-w-4xl mx-auto p-6\">Loading…</main>;\r\n\r\n  const avatarUrl = toImageSrc(user.avatarUrl || undefined);\r\n\r\n  return (\r\n    <main className=\"max-w-5xl mx-auto p-6\">\r\n      <h1 className=\"text-2xl font-bold\">Your Account</h1>\r\n      {(err || info) && (\r\n        <p className={`mt-4 ${err ? \"text-red-600\" : \"text-green-700\"}`}>\r\n          {err || info}\r\n        </p>\r\n      )}\r\n\r\n      <div className=\"mt-6 flex gap-2 border-b\">\r\n        {tabs.map((t) => (\r\n          <button\r\n            key={t}\r\n            className={`px-3 py-2 -mb-px border-b-2 ${tab === t ? \"border-indigo-600 text-indigo-700\" : \"border-transparent text-gray-600\"}`}\r\n            onClick={() => setTab(t)}\r\n          >\r\n            {t}\r\n          </button>\r\n        ))}\r\n      </div>\r\n\r\n      {tab === \"Profile\" && (\r\n        <section className=\"mt-6 grid md:grid-cols-3 gap-6\">\r\n          <div className=\"md:col-span-2 bg-white p-4 border rounded\">\r\n            <form onSubmit={onSaveProfile} className=\"grid gap-3\">\r\n              <label className=\"text-sm text-gray-600\">Display name</label>\r\n              <input\r\n                className=\"border p-2 rounded\"\r\n                value={name}\r\n                onChange={(e) => setName(e.target.value)}\r\n              />\r\n              <div className=\"text-sm text-gray-600\">Email</div>\r\n              <div className=\"p-2 border rounded bg-gray-50\">{user.email}</div>\r\n              <div className=\"text-sm text-gray-600\">Email status</div>\r\n              <div className=\"p-2 border rounded bg-gray-50\">\r\n                {user.emailConfirmed ? \"Verified\" : \"Not verified\"}\r\n              </div>\r\n              <button\r\n                disabled={busy}\r\n                className=\"mt-2 px-4 py-2 rounded bg-indigo-600 text-white disabled:opacity-60\"\r\n              >\r\n                {busy ? \"Saving…\" : \"Save\"}\r\n              </button>\r\n            </form>\r\n          </div>\r\n          <div className=\"bg-white p-4 border rounded\">\r\n            <div className=\"text-sm text-gray-600\">Profile picture</div>\r\n            <img\r\n              src={avatarUrl || \"/placeholder.png\"}\r\n              alt=\"avatar\"\r\n              className=\"w-32 h-32 object-cover rounded-full border mt-2\"\r\n              onError={(e) => {\r\n                (e.currentTarget as HTMLImageElement).src = \"/placeholder.png\";\r\n              }}\r\n            />\r\n            <form onSubmit={onUploadAvatar} className=\"mt-3 grid gap-2\">\r\n              <input\r\n                type=\"file\"\r\n                accept=\"image/*\"\r\n                onChange={(e) => setAvatarFile(e.target.files?.[0] ?? null)}\r\n              />\r\n              <button\r\n                disabled={busy || !avatarFile}\r\n                className=\"px-3 py-1.5 rounded border\"\r\n              >\r\n                {busy ? \"Uploading…\" : \"Upload\"}\r\n              </button>\r\n            </form>\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {tab === \"Verification\" && (\r\n        <section className=\"mt-6 grid md:grid-cols-2 gap-6\">\r\n          <div className=\"bg-white p-4 border rounded\">\r\n            <h2 className=\"font-semibold\">Status</h2>\r\n            <p className=\"mt-2 text-sm\">\r\n              KYC: <strong>{kyc?.status ?? \"none\"}</strong>\r\n              {kyc?.reviewedAt && (\r\n                <> • Reviewed {new Date(kyc.reviewedAt).toLocaleString()}</>\r\n              )}\r\n            </p>\r\n            <div className=\"mt-3 grid grid-cols-2 gap-3\">\r\n              <div>\r\n                <div className=\"text-sm text-gray-600\">NIC</div>\r\n                {kyc?.nic ? (\r\n                  <img\r\n                    src={toImageSrc(kyc.nic)}\r\n                    alt=\"nic\"\r\n                    className=\"mt-1 w-full h-36 object-cover border rounded\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"mt-1 text-xs text-gray-500\">Not uploaded</div>\r\n                )}\r\n              </div>\r\n              <div>\r\n                <div className=\"text-sm text-gray-600\">Selfie</div>\r\n                {kyc?.selfie ? (\r\n                  <img\r\n                    src={toImageSrc(kyc.selfie)}\r\n                    alt=\"selfie\"\r\n                    className=\"mt-1 w-full h-36 object-cover border rounded\"\r\n                  />\r\n                ) : (\r\n                  <div className=\"mt-1 text-xs text-gray-500\">Not uploaded</div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div className=\"bg-white p-4 border rounded\">\r\n            <h2 className=\"font-semibold\">Upload documents</h2>\r\n            <div className=\"mt-3\">\r\n              <div className=\"text-sm text-gray-600\">NIC image</div>\r\n              <div className=\"flex gap-2 mt-1\">\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => setNicFile(e.target.files?.[0] ?? null)}\r\n                />\r\n                <button\r\n                  onClick={() => submitKyc(\"nic\")}\r\n                  disabled={!nicFile || busy}\r\n                  className=\"px-3 py-1.5 rounded border\"\r\n                >\r\n                  Upload NIC\r\n                </button>\r\n              </div>\r\n            </div>\r\n            <div className=\"mt-4\">\r\n              <div className=\"text-sm text-gray-600\">Selfie</div>\r\n              <div className=\"flex gap-2 mt-1\">\r\n                <input\r\n                  type=\"file\"\r\n                  accept=\"image/*\"\r\n                  onChange={(e) => setSelfieFile(e.target.files?.[0] ?? null)}\r\n                />\r\n                <button\r\n                  onClick={() => submitKyc(\"selfie\")}\r\n                  disabled={!selfieFile || busy}\r\n                  className=\"px-3 py-1.5 rounded border\"\r\n                >\r\n                  Upload Selfie\r\n                </button>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </section>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}