{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 5, "column": 0}, "map": {"version":3,"sources":["file:///D:/Bidforge/frontend/src/app/sell/page.tsx"],"sourcesContent":["// File: src/app/sell/page.tsx\r\n\"use client\";\r\n\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport { useSession } from \"../../lib/session\";\r\nimport { apiFetch, apiFetchForm } from \"../../lib/api\";\r\nimport { toImageSrc } from \"../../lib/Config\";\r\n\r\ntype MyAuction = {\r\n  id: number;\r\n  title: string;\r\n  currentBid: number;\r\n  endTime: string;\r\n  image?: string | null;\r\n  badge?: string | null;\r\n};\r\n\r\nexport default function SellPage() {\r\n  const router = useRouter();\r\n  const { user, loading, refresh } = useSession();\r\n\r\n  const [form, setForm] = useState({\r\n    title: \"\",\r\n    description: \"\",\r\n    startingBid: \"\",\r\n    endTime: \"\",\r\n    badge: \"\",\r\n  });\r\n  const [image, setImage] = useState<File | null>(null);\r\n\r\n  const [err, setErr] = useState<string | null>(null);\r\n  const [info, setInfo] = useState<string | null>(null);\r\n  const [busy, setBusy] = useState(false);\r\n\r\n  const [mine, setMine] = useState<MyAuction[] | null>(null);\r\n  const [loadingMine, setLoadingMine] = useState(false);\r\n\r\n  // Require login\r\n  useEffect(() => {\r\n    void refresh();\r\n  }, [refresh]);\r\n\r\n  useEffect(() => {\r\n    if (!loading && !user) {\r\n      router.replace(\"/auth/login?next=/sell\");\r\n    }\r\n  }, [loading, user, router]);\r\n\r\n  const loadMine = async () => {\r\n    setLoadingMine(true);\r\n    try {\r\n      const items = await apiFetch<MyAuction[]>(\"/api/my/auctions\");\r\n      setMine(items);\r\n    } catch (e: any) {\r\n      setMine([]);\r\n      setErr(e?.message ?? \"Failed to load your auctions\");\r\n    } finally {\r\n      setLoadingMine(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) void loadMine();\r\n  }, [user]);\r\n\r\n  const set = (k: keyof typeof form, v: string) =>\r\n    setForm((s) => ({ ...s, [k]: v }));\r\n\r\n  const onSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    setErr(null);\r\n    setInfo(null);\r\n\r\n    // quick checks\r\n    if (!form.title.trim()) return setErr(\"Title is required.\");\r\n    if (!form.endTime || Number.isNaN(Date.parse(form.endTime)))\r\n      return setErr(\"Please pick a valid end time.\");\r\n\r\n    setBusy(true);\r\n    try {\r\n      const fd = new FormData();\r\n      fd.append(\"Title\", form.title.trim());\r\n      if (form.description.trim())\r\n        fd.append(\"Description\", form.description.trim());\r\n\r\n      const start = (form.startingBid || \"\").trim();\r\n      const starting = start ? Number(start) : 0;\r\n      if (Number.isNaN(starting) || starting < 0)\r\n        throw new Error(\"Starting bid must be a number ≥ 0.\");\r\n      fd.append(\"StartingBid\", String(starting));\r\n\r\n      // backend expects UTC\r\n      const endIso = new Date(form.endTime).toISOString();\r\n      fd.append(\"EndTimeUtc\", endIso);\r\n\r\n      if (form.badge.trim()) fd.append(\"Badge\", form.badge.trim());\r\n      if (image) fd.append(\"Image\", image);\r\n\r\n      // with Authorization header (apiFetchForm does it)\r\n      const res = await apiFetchForm<{ id: number }>(\"/api/auctions\", fd, {\r\n        method: \"POST\",\r\n      });\r\n\r\n      setInfo(\"Auction created!\");\r\n      setForm({\r\n        title: \"\",\r\n        description: \"\",\r\n        startingBid: \"\",\r\n        endTime: \"\",\r\n        badge: \"\",\r\n      });\r\n      setImage(null);\r\n\r\n      // reload mine\r\n      await loadMine();\r\n\r\n      // optional: redirect to detail\r\n      // router.push(`/productDetail/${res.id}`);\r\n    } catch (e: any) {\r\n      setErr(e?.message ?? \"Create failed\");\r\n    } finally {\r\n      setBusy(false);\r\n    }\r\n  };\r\n\r\n  const onDelete = async (id: number) => {\r\n    if (!confirm(\"Delete this auction?\")) return;\r\n    try {\r\n      await apiFetch(`/api/auctions/${id}`, { method: \"DELETE\" });\r\n      await loadMine();\r\n    } catch (e: any) {\r\n      alert(e?.message ?? \"Delete failed\");\r\n    }\r\n  };\r\n\r\n  if (loading || !user) {\r\n    return (\r\n      <main className=\"max-w-3xl mx-auto p-6\">Checking authentication…</main>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <main className=\"max-w-6xl mx-auto p-6\">\r\n      <h1 className=\"text-2xl font-bold\">Sell</h1>\r\n\r\n      {err && <p className=\"mt-4 text-red-600 whitespace-pre-wrap\">{err}</p>}\r\n      {info && <p className=\"mt-4 text-green-600\">{info}</p>}\r\n\r\n      {/* Create form */}\r\n      <form onSubmit={onSubmit} className=\"mt-6 grid gap-4 max-w-3xl\">\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          placeholder=\"Title\"\r\n          value={form.title}\r\n          onChange={(e) => set(\"title\", e.target.value)}\r\n          required\r\n        />\r\n\r\n        <textarea\r\n          className=\"border p-2 rounded\"\r\n          placeholder=\"Description\"\r\n          value={form.description}\r\n          onChange={(e) => set(\"description\", e.target.value)}\r\n          rows={4}\r\n        />\r\n\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          type=\"number\"\r\n          min=\"0\"\r\n          step=\"0.01\"\r\n          placeholder=\"Starting bid (LKR)\"\r\n          value={form.startingBid}\r\n          onChange={(e) => set(\"startingBid\", e.target.value)}\r\n        />\r\n\r\n        <label className=\"text-sm text-gray-600\">\r\n          End time (your local time)\r\n          <input\r\n            className=\"border p-2 rounded w-full mt-1\"\r\n            type=\"datetime-local\"\r\n            value={form.endTime}\r\n            onChange={(e) => set(\"endTime\", e.target.value)}\r\n            required\r\n          />\r\n        </label>\r\n\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          placeholder=\"Badge (optional)\"\r\n          value={form.badge}\r\n          onChange={(e) => set(\"badge\", e.target.value)}\r\n        />\r\n\r\n        <input\r\n          className=\"border p-2 rounded\"\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n          onChange={(e) => setImage(e.target.files?.[0] ?? null)}\r\n        />\r\n\r\n        <button\r\n          type=\"submit\"\r\n          disabled={busy}\r\n          className=\"px-4 py-2 rounded bg-indigo-600 text-white disabled:opacity-60\"\r\n        >\r\n          {busy ? \"Creating…\" : \"Create\"}\r\n        </button>\r\n      </form>\r\n\r\n      {/* My auctions */}\r\n      <section className=\"mt-10\">\r\n        <h2 className=\"text-xl font-semibold\">Your Auctions</h2>\r\n        {loadingMine && (\r\n          <p className=\"mt-4 text-gray-600\">Loading your auctions…</p>\r\n        )}\r\n        {mine && mine.length === 0 && (\r\n          <p className=\"mt-4 text-gray-600\">\r\n            You haven’t created any auctions yet.\r\n          </p>\r\n        )}\r\n\r\n        {mine && mine.length > 0 && (\r\n          <div className=\"mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-5\">\r\n            {mine.map((a) => {\r\n              const src = toImageSrc(a.image);\r\n              return (\r\n                <article\r\n                  key={a.id}\r\n                  className=\"rounded-xl overflow-hidden border bg-white\"\r\n                >\r\n                  <div className=\"aspect-[4/3] overflow-hidden bg-gray-100\">\r\n                    <img\r\n                      src={src}\r\n                      alt={a.title}\r\n                      className=\"w-full h-full object-cover\"\r\n                      onError={(e) => {\r\n                        (e.currentTarget as HTMLImageElement).src =\r\n                          \"/placeholder.png\";\r\n                      }}\r\n                      loading=\"lazy\"\r\n                    />\r\n                  </div>\r\n                  <div className=\"p-4\">\r\n                    <h3 className=\"font-semibold line-clamp-2\">{a.title}</h3>\r\n                    <p className=\"mt-1 text-sm text-gray-600\">Current bid</p>\r\n                    <p className=\"font-semibold\">\r\n                      LKR {a.currentBid.toLocaleString()}\r\n                    </p>\r\n                    <div className=\"mt-3 flex gap-3\">\r\n                      <button\r\n                        onClick={() => onDelete(a.id)}\r\n                        className=\"px-3 py-1 border rounded text-red-600 border-red-300 hover:bg-red-50\"\r\n                      >\r\n                        Delete\r\n                      </button>\r\n                    </div>\r\n                  </div>\r\n                </article>\r\n              );\r\n            })}\r\n          </div>\r\n        )}\r\n      </section>\r\n    </main>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}